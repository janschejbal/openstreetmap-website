<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="<%= I18n.locale %>" lang="<%= I18n.locale %>" dir="<%= t'html.dir' %>">
  <%= render :partial => "layouts/head" %>
  <body class="<%= params[:controller] %>">
    <div id="small-title">
      <%= link_to(image_tag("signet.png", :size => "16x16", :border => 0, :alt => t('layouts.logo.alt_text')), :controller => 'site', :action => 'index') %>
      <h1><a href="/"><%= t 'layouts.project_name.h1' %></a></h1>
    </div>
    <div id="content" class="<%= params[:controller] %>_<%= params[:action] %>">
      <%= render :partial => "layouts/flash", :locals => { :flash => flash } %>

      <%= yield %>
    </div>

    <div id='top-bar'>
      <span id="greeting">
         <% if @user and @user.id %>
           <span id="full-greeting"><%= raw(t 'layouts.welcome_user', :user_link => (link_to h(@user.display_name), {:controller => 'user', :action => 'view', :display_name => @user.display_name}, :title => t('layouts.welcome_user_link_tooltip'))) %></span> 
           <span id="small-greeting"><%= link_to t('layouts.welcome_user_link_tooltip'), {:controller => 'user', :action => 'view', :display_name => @user.display_name} %></span> | 
           <%= yield :greeting %>
           <%= render :partial => "layouts/inbox" %> |
           <%= link_to t('layouts.logout'), {:controller => 'user', :action => 'logout', :session => request.session_options[:id], :referer => request.fullpath}, {:id => 'logoutanchor', :title => t('layouts.logout_tooltip')}%>
         <% else %>
           <%= link_to t('layouts.log_in'), {:controller => 'user', :action => 'login', :referer => request.fullpath}, {:id => 'loginanchor', :title => t('layouts.log_in_tooltip')} %> |
           <%= link_to t('layouts.sign_up'), {:controller => 'user', :action => 'new'}, {:id => 'registeranchor', :title => t('layouts.sign_up_tooltip')} %>
         <% end %>
      </span>
      <ul id="tabnav">
        <%
        viewclass = 'geolink llz layers'
        editclass = 'geolink llz object minzoom13 disabled'
        historyclass = 'geolink bbox minzoom11'
        exportclass = 'geolink llz layers'
        viewclass += ' active' if params['controller'] == 'site' and params['action'] == 'index'
        editclass += ' active' if params['controller'] == 'site' and params['action'] == 'edit'
        historyclass += ' active' if params['controller'] == 'changeset' and params['action'] == 'list'
        exportclass += ' active' if params['controller'] == 'site' and params['action'] == 'export'
        %>
        <li><%= link_to t('layouts.view'), {:controller => 'site', :action => 'index'}, {:id => 'viewanchor', :title => t('layouts.view_tooltip'), :class => viewclass} %></li>
        <li><%= link_to h(t('layouts.edit')) + content_tag(:span, "â–¾", :class => "menuicon"), {:controller => 'site', :action => 'edit'}, {:id => 'editanchor', :title => t('javascripts.site.edit_tooltip'), :class => editclass} %></li>
        <li><%= link_to t('layouts.history'), {:controller => 'changeset', :action => 'list' }, {:id => 'historyanchor', :title => t('javascripts.site.history_tooltip'), :class => historyclass} %></li>
        <li><%= link_to t('layouts.export'), {:controller => 'site', :action => 'export'}, {:id => 'exportanchor', :title => t('layouts.export_tooltip'), :class => exportclass} %></li>
      </ul>
    </div>

    <div id="editmenu" class="menu">
      <ul>
        <% Editors::ALL_EDITORS.each do |editor| %>
          <li><%= link_to t('layouts.edit_with', :editor => t("editor.#{editor}.description")), {:controller => 'site', :action => 'edit', :editor => editor}, {:id => editor + 'anchor', :class => "geolink llz object"} %></li>
        <% end %>
        <%= yield :editmenu %>
      </ul>
    </div>

    <script type="text/javascript">
      createMenu("editanchor", "editmenu", "left");
    </script>

    <div id="left">
      <div id="logo">
        <%= link_to(image_tag("signet.png", :size => "24x24", :border => 0, :alt => t('layouts.logo.alt_text')), :controller => 'site', :action => 'index') %>
        <h1><%= t 'layouts.project_name.h1' %></h1>
      </div>

      <%= yield :optionals %>

    </div>

    <% if defined?(PIWIK_LOCATION) and defined?(PIWIK_SITE) -%>
    <%= render :partial => "layouts/piwik" %>
    <% end -%>
  </body>
</html>
